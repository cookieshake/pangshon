#!/usr/bin/env bash
set -euo pipefail

if [[ ${1:-} == "-h" || ${1:-} == "--help" || $# -lt 2 ]]; then
  cat <<'USAGE'
Usage: push <image> <registry/namespace> [tag]

Tags the local image and pushes to the registry.
Default tag is 'latest'. Ensure you're logged in (`docker login`).

Examples:
  push template-python ghcr.io/you
  push template-python ghcr.io/you v0.1.0
USAGE
  exit 0
fi

IMAGE="$1"; shift
REGISTRY_NS="$1"; shift
TAG="${1:-latest}"

REMOTE_REF="$REGISTRY_NS/$IMAGE:$TAG"

if ! command -v docker >/dev/null 2>&1; then
  echo "docker not found. Please install and start Docker." >&2
  exit 1
fi

echo "Tagging $IMAGE as $REMOTE_REF"
docker tag "$IMAGE" "$REMOTE_REF"

echo "Pushing $REMOTE_REF"
docker push "$REMOTE_REF"

echo "âœ” Pushed $REMOTE_REF"

